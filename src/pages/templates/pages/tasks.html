{% extends "layouts/index.html" %}

{% block title %}
  Celery Tasks
  <style>
    .th-link {
      display: block;
      width: 100%;
      height: 100%;
      padding: 0.75rem 1.5rem; /* Apply padding to the link instead of the th */
      margin: -0.75rem -1.5rem; /* Negative margin to offset the padding */
      text-decoration: none; /* Remove underline from link */
      color: inherit; /* Inherit color from parent */
    }
    .th-link:hover {
      text-decoration: none; /* Ensure no underline on hover */
    }
  </style>
{% endblock %}

{% block body %}
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-4">Celery Task Entries</h1>

    <div class="overflow-x-auto">
      <table id="task-table" class="min-w-full bg-white border border-gray-200">
        <thead>
          <tr class="bg-gray-100">
            <th class="px-0 py-0 border-b border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              <a class="th-link" href="?sort_by=completed&sort_order={% if sort_by == 'completed' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                Completed
                {% if sort_by == 'completed' %}
                  <span class="sort-arrow {% if sort_order == 'asc' %}asc{% else %}desc{% endif %}"></span>
                {% endif %}
              </a>
            </th>
            
            <th class="px-0 py-0 border-b border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              <a class="th-link" href="?sort_by=task_id&sort_order={% if sort_by == 'task_id' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                Task ID
                {% if sort_by == 'task_id' %}
                  <span class="sort-arrow {% if sort_order == 'asc' %}asc{% else %}desc{% endif %}"></span>
                {% endif %}
              </a>
            </th>
            <th class="w-fit px-0 py-0 border-b border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              <a class="th-link" href="?sort_by=status&sort_order={% if sort_by == 'status' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                Status
                {% if sort_by == 'status' %}
                  <span class="sort-arrow {% if sort_order == 'asc' %}asc{% else %}desc{% endif %}"></span>
                {% endif %}
              </a>
            </th>
            <th class="w-fit px-0 py-0 border-b border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              <a class="th-link" href="?sort_by=result&sort_order={% if sort_by == 'result' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                Name
                {% if sort_by == 'result' %}
                  <span class="sort-arrow {% if sort_order == 'asc' %}asc{% else %}desc{% endif %}"></span>
                {% endif %}
              </a>
            </th>
            <th class="px-0 py-0 border-b border-gray-200 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              <a class="th-link" href="?sort_by=date_done&sort_order={% if sort_by == 'date_done' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                Date Done
                {% if sort_by == 'date_done' %}
                  <span class="sort-arrow {% if sort_order == 'asc' %}asc{% else %}desc{% endif %}"></span>
                {% endif %}
              </a>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white">
          {% for task in tasks %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap border-b border-gray-200">
                <input type="checkbox" class="task-completed-checkbox" data-task-id="{{ task.task_id }}" {% if task.completed %}checked{% endif %}>
              </td>
              <td class="px-6 py-4 whitespace-nowrap border-b border-gray-200">{{ task.task_id }}</td>
              <td class="px-6 py-4 whitespace-nowrap border-b border-gray-200">{{ task.status }}</td>
              <td class="px-6 py-4 whitespace-nowrap border-b border-gray-200">{{ task.result }}</td>
              <td class="px-6 py-4 whitespace-nowrap border-b border-gray-200">{{ task.date_done }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
